import pyaudio
import pyttsx3
import speech_recognition as sr

# Initialize the recognizer
recognizer = sr.Recognizer()

# Initialize the text-to-speech engine
tts_engine = pyttsx3.init()

# Function to capture audio and recognize speech
def recognize_speech_from_mic(recognizer, microphone):
    with microphone as source:
        recognizer.adjust_for_ambient_noise(source)
        audio = recognizer.listen(source)

    response = {
        "success": True,
        "error": None,
        "transcription": None
    }

    try:
        response["transcription"] = recognizer.recognize_google(audio)
    except sr.RequestError:
        response["success"] = False
        response["error"] = "API unavailable"
    except sr.UnknownValueError:
        response["error"] = "Unable to recognize speech"

    return response

# Initialize the microphone
microphone = sr.Microphone()

print("Listening...")

try:
    while True:
        speech_to_text_result = recognize_speech_from_mic(recognizer, microphone)
        if speech_to_text_result["transcription"]:
            print(f"Recognized: {speech_to_text_result['transcription']}")
            tts_engine.say(speech_to_text_result['transcription'])
            tts_engine.runAndWait()
        elif speech_to_text_result["error"]:
            print(f"Error: {speech_to_text_result['error']}")
except KeyboardInterrupt:
    print("Stopping...")